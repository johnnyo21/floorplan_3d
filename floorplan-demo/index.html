<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Floorplan Card Demo</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f0f2f5;
        }
        h1 {
            position: absolute;
            top: 10px;
            left: 20px;
            z-index: 100;
            color: #333;
            font-weight: 300;
        }
        floorplan-3d-card {
            width: 100%;
            height: 100%;
            display: block;
        }
    </style>
</head>
<body>
    <h1>3D Floorplan Demo</h1>

    <floorplan-3d-card></floorplan-3d-card>

    <script type="module">
        // Import the card's class so we can use it.
        // The path must match your file structure.
        import './floorplan-3d-card.js';

        // Wait until the custom element is fully defined and ready.
        customElements.whenDefined('floorplan-3d-card').then(() => {
            const card = document.querySelector('floorplan-3d-card');

            // --- Card Configuration ---
            // This is where you tell the card what to load.
            // Paths are relative to index.html.
            const config = {
                obj_path: './models/demo_model.obj',
                mtl_path: './models/demo_model.mtl',
                ambient_light_intensity: 0.4,
                debug_mode: true, // Logs click coordinates to the console
                light_map: [
                    {
                        entity_id: 'light.ceiling',
                        object_name: 'LightFixture_Ceiling',
                        intensity: 1.5,
                        color: '0xffffff' // Default white
                    },
                    {
                        entity_id: 'light.corner_lamp',
                        object_name: 'LightFixture_Corner',
                        intensity: 3,
                        color: '0xffd1b2' // Warm orange
                    }
                ]
            };

            // --- Mock Home Assistant State ---
            // This object simulates the 'hass' object from Home Assistant.
            // The card reads this object to determine light states.
            let mockHass = {
                states: {
                    'light.ceiling': {
                        state: 'off',
                        attributes: { brightness: 0, rgb_color: [255, 255, 255] }
                    },
                    'light.corner_lamp': {
                        state: 'off',
                        attributes: { brightness: 0, rgb_color: [255, 209, 178] }
                    }
                },
                // The card calls this function when an object is clicked.
                // We'll just log it for the demo.
                callService: (domain, service, data) => {
                    console.log(`Service Called: ${domain}.${service}`, data);
                    toggleLight(data.entity_id);
                }
            };

            // Apply the initial configuration and mock hass object to the card
            card.config = config;
            card.hass = mockHass;

            // --- Light Animation Logic ---
            const lights = ['light.ceiling', 'light.corner_lamp'];
            let currentLightIndex = 0;

            function toggleLight(entityId) {
                const currentState = mockHass.states[entityId];
                if (currentState.state === 'on') {
                    // Turn off
                    currentState.state = 'off';
                    currentState.attributes.brightness = 0;
                } else {
                    // Turn on
                    currentState.state = 'on';
                    currentState.attributes.brightness = 255; // Full brightness
                }
                // IMPORTANT: Re-assign the hass object to trigger the card's update cycle
                card.hass = { ...mockHass };
            }

            function animateLights() {
                // Toggle the current light
                toggleLight(lights[currentLightIndex]);
                
                // Move to the next light for the next cycle
                currentLightIndex = (currentLightIndex + 1) % lights.length;
                
                // Run this function again after 3 seconds
                setTimeout(animateLights, 3000);
            }

            // Start the animation after an initial delay
            setTimeout(animateLights, 2000);
        });
    </script>
</body>
</html>
